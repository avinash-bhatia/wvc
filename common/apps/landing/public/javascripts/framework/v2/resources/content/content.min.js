/*! Crocodoc Viewer - v0.10.8 | (c) 2015 Box */

!function(e){"use strict";e.Crocodoc=function(e){return"object"!=typeof exports?e(jQuery):void(module.exports=e)}(function(t){function n(){e.loadSVG=function(t){var n=new e.DOMParser,a=n.parseFromString(t,"image/svg+xml"),o=document.importNode(a.documentElement,!0);o.setAttribute("width","100%"),o.setAttribute("height","100%"),document.body?document.body.appendChild(o):document.documentElement.appendChild(o)}}var a="crocodoc-",o="data-svg-version",i=a+"viewer",r=a+"doc",s=a+"viewport",l=a+"viewer-logo",c=a+"draggable",u=a+"dragging",d=a+"text-selected",f=a+"text-disabled",g=a+"links-disabled",p=a+"mobile",h=a+"ielt9",m=a+"supports-svg",v=a+"window-as-viewport",y=a+"layout-",b=a+"current-page",w=a+"preceding-page",T=a+"page",P=T+"-inner",S=T+"-content",_=T+"-svg",x=T+"-text",C=T+"-link",L=T+"-links",O=T+"-autoscale",R=T+"-loading",E=T+"-error",U=T+"-visible",O=T+"-autoscale",z=T+"-prev",Z=T+"-next",A=T+"-before",k=T+"-after",M=T+"-before-buffer",I=T+"-after-buffer",H=[Z,k,z,A,M,I].join(" "),V='<div tabindex="-1" class="'+s+'"><div class="'+r+'"></div></div><div class="'+l+'"></div>',D='<div class="'+T+" "+R+'" style="width:{{w}}px; height:{{h}}px;" data-width="{{w}}" data-height="{{h}}"><div class="'+P+'"><div class="'+S+'"><div class="'+_+'"></div><div class="'+O+'"><div class="'+x+'"></div><div class="'+L+'"></div></div></div></div></div>',N=1024,F="fitwidth",q="fitheight",W="auto",$="in",j="out",X="previous",G="next",B="vertical",Y="vertical-single-column",Q="horizontal",J="presentation",K="presentation-two-page",ee="text",te="converting",ne="not loaded",ae="loading",oe="loaded",ie="error",re="padding-",se=re+"top",le=re+"right",ce=re+"left",ue=re+"bottom",de=.95,fe=.99,ge=100,pe=32,he=8,me=1e3,ve="image/svg+xml",ye="<style>html,body{width:100%;height:100%;margin:0;overflow:hidden;}</style>",be='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"><script><![CDATA[('+n+")()]]></script></svg>",we=1,Te=2,Pe=3,Se=4,_e=5,xe=6,Ce=7,Le=8;if("undefined"==typeof t)throw new Error("jQuery is required");var Oe=function(){function e(n,a,o){var i;for(o=o||n,i=0;i<a.length;++i){if(n===a[i])throw new Error("Circular dependency detected: "+o+"->"+a[i]);t[a[i]]&&e(n,t[a[i]].mixins,o+"->"+a[i])}}var t={},n={};return{ZOOM_FIT_WIDTH:F,ZOOM_FIT_HEIGHT:q,ZOOM_AUTO:W,ZOOM_IN:$,ZOOM_OUT:j,SCROLL_PREVIOUS:X,SCROLL_NEXT:G,LAYOUT_VERTICAL:B,LAYOUT_VERTICAL_SINGLE_COLUMN:Y,LAYOUT_HORIZONTAL:Q,LAYOUT_PRESENTATION:J,LAYOUT_PRESENTATION_TWO_PAGE:K,LAYOUT_TEXT:ee,ASSET_REQUEST_RETRIES:1,viewerTemplate:V,pageTemplate:D,components:t,utilities:n,createViewer:function(e,t){return new Oe.Viewer(e,t)},getViewer:function(e){return Oe.Viewer.get(e)},addComponent:function(n,a,o){a instanceof Function&&(o=a,a=[]),e(n,a),t[n]={mixins:a,creator:o}},createComponent:function(e,n){var a=t[e];if(a){for(var o=[],i=0;i<a.mixins.length;++i)o.push(this.createComponent(a.mixins[i],n));return o.unshift(n),a.creator.apply(a.creator,o)}return null},addPlugin:function(e,t){this.addComponent("plugin-"+e,t)},addDataProvider:function(e,t){this.addComponent("data-provider-"+e,t)},addUtility:function(e,t){n[e]={creator:t,instance:null}},getUtility:function(e){var t=n[e];return t?(t.instance||(t.instance=t.creator(this)),t.instance):null}}}();return function(){Oe.Scope=function(e){function n(e,t){var n,a,o,s;for(n=0,a=r.length;a>n;++n)o=r[n],o&&(s=o.messages||[],-1!==i.inArray(e,s)&&i.isFn(o.onmessage)&&o.onmessage.call(o,e,t))}function a(){for(var e;s.length;)e=s.shift(),n(e.name,e.data);s=null}function o(e){i.isFn(e.destroy)&&!e._destroyed&&(e.destroy(),e._destroyed=!0)}var i=Oe.getUtility("common"),r=[],s=[],l={},c=!1;e.dataProviders=e.dataProviders||{},this.createComponent=function(e){var t=Oe.createComponent(e,this);return t&&(t.componentName=e,r.push(t)),t},this.destroyComponent=function(e){var t,n;for(t=0,n=r.length;n>t;++t)if(e===r[t]){o(e),r.splice(t,1);break}},this.destroy=function(){var e,t,n,a=r.slice();for(e=0,t=a.length;t>e;++e)n=a[e],o(n);r=[],l={}},this.broadcast=function(e,t){c?n(e,t):s.push({name:e,data:t})},this.getUtility=function(e){return Oe.getUtility(e)},this.getConfig=function(){return e},this.ready=function(){c||(c=!0,a())},this.get=function(n,a){var o=e.dataProviders[n]||n,i=this.getDataProvider(o);return i?i.get(n,a):t.Deferred().reject("data-provider not found").promise()},this.getDataProvider=function(e){var t;return l[e]?t=l[e]:(t=this.createComponent("data-provider-"+e),l[e]=t),t}}}(),function(){function e(e,t){var n=!1;return{type:e,data:t,preventDefault:function(){n=!0},isDefaultPrevented:function(){return n}}}Oe.EventTarget=function(){this._handlers={}},Oe.EventTarget.prototype={constructor:Oe.EventTarget,on:function(e,t){"undefined"==typeof this._handlers[e]&&(this._handlers[e]=[]),this._handlers[e].push(t)},fire:function(t,n){var a,o,i,r=e(t,n);if(a=this._handlers[r.type],a instanceof Array)for(a=a.concat(),o=0,i=a.length;i>o;o++)a[o]&&a[o].call(this,r);if(a=this._handlers.all,a instanceof Array)for(a=a.concat(),o=0,i=a.length;i>o;o++)a[o]&&a[o].call(this,r);return r},off:function(e,t){var n,a,o=this._handlers[e];if(o instanceof Array){if(!t)return void(o.length=0);for(n=0,a=o.length;a>n;n++)if(o[n]===t||o[n].handler===t){o.splice(n,1);break}}},one:function(e,t){var n=this,a=function(o){n.off(e,a),t.call(n,o)};a.handler=t,this.on(e,a)}}}(),function(){var e=0,n={};Oe.Viewer=function(a,o){function i(){d.init()}Oe.EventTarget.call(this);var r,s=Oe.getUtility("common"),l=t(a),c=s.extend(!0,{},Oe.Viewer.defaults,o),u=new Oe.Scope(c),d=u.createComponent("viewer-base");if(0===l.length)throw new Error("Invalid container element");this.id=c.id=++e,c.api=this,c.$el=l,n[this.id]=this,this.destroy=function(){delete n[c.id],u.broadcast("destroy"),u.destroy()},this.load=function(){d.loadAssets()},this.setLayout=function(e){r=null,r=d.setLayout(e)},this.zoom=function(e){var t=parseFloat(e);r&&(t&&(e=t/(c.pageScale||1)),r.setZoom(e))},this.scrollTo=function(e){r&&s.isFn(r.scrollTo)&&r.scrollTo(e)},this.scrollBy=function(e,t){r&&r.scrollBy(e,t)},this.focus=function(){r&&r.focus()},this.enableTextSelection=function(){l.toggleClass(f,!1),c.enableTextSelection||(c.enableTextSelection=!0,u.broadcast("textenabledchange",{enabled:!0}))},this.disableTextSelection=function(){l.toggleClass(f,!0),c.enableTextSelection&&(c.enableTextSelection=!1,u.broadcast("textenabledchange",{enabled:!1}))},this.enableLinks=function(){c.enableLinks||(l.removeClass(g),c.enableLinks=!0)},this.disableLinks=function(){c.enableLinks&&(l.addClass(g),c.enableLinks=!1)},this.updateLayout=function(){r&&r.update()},i()},Oe.Viewer.prototype=new Oe.EventTarget,Oe.Viewer.prototype.constructor=Oe.Viewer,Oe.Viewer.get=function(e){return n[e]},Oe.Viewer.defaults={url:null,layout:B,zoom:W,page:1,enableTextSelection:!0,enableLinks:!0,enableDragging:!1,queryParams:null,plugins:{},useWindowAsViewport:!1,conversionIsComplete:!0,template:{svg:"page-{{page}}.svg",img:"page-{{page}}.png",html:"text-{{page}}.html",css:"stylesheet.css",json:"info.json"},dataProviders:{metadata:"metadata",stylesheet:"stylesheet","page-svg":"page-svg","page-text":"page-text","page-img":"page-img"},pageStart:null,pageEnd:null,autoloadFirstPage:!0,zoomLevels:[.25,.5,.75,1,1.25,1.5,2,3]}}(),Oe.addDataProvider("metadata",function(e){function t(e){return a.parseJSON(e)}var n=e.getUtility("ajax"),a=e.getUtility("common"),o=e.getConfig();return{get:function(){var e=this.getURL(),a=n.fetch(e,Oe.ASSET_REQUEST_RETRIES);return a.then(t).promise({abort:a.abort})},getURL:function(){var e=o.template.json;return o.url+e+o.queryString}}}),Oe.addDataProvider("page-img",function(e){var n=e.getUtility("common"),a=e.getConfig();return{get:function(e,n){function a(){i.setAttribute("src",l)}function o(){i&&i.removeAttribute("src")}var i=this.getImage(),r=Oe.ASSET_REQUEST_RETRIES,s=!1,l=this.getURL(n),c=t.Deferred();return i.onload=function(){s=!0,c.resolve(i)},i.onerror=function(){r>0?(r--,o(),a()):(i=null,s=!1,c.reject({error:"image failed to load",resource:l}))},a(),c.promise({abort:function(){s||(o(),c.reject())}})},getURL:function(e){var t=n.template(a.template.img,{page:e});return a.url+t+a.queryString},getImage:function(){return new Image}}}),Oe.addDataProvider("page-svg",function(e){function t(e,t){var n="<style>"+t+"</style>";return r.firefox&&!s.isSubpxSupported()&&(n+="<style>text { text-rendering: geometricPrecision; }</style>"),e=e.replace(d,n)}function n(n){if(!c){var i,r=l.queryString.replace("&","&#38;");return i=o.countInStr(n,'xlink:href="data:image'),i>a&&(n=n.replace(/<image[\s\w-_="]*xlink:href="data:image\/[^"]{0,5120}"[^>]*>/gi,"")),n=n.replace(/href="([^"#:]*)"/g,function(e,t){return'href="'+l.url+t+r+'"'}),e.get("stylesheet").then(function(e){return t(n,e)})}}var a=1e3,o=e.getUtility("common"),i=e.getUtility("ajax"),r=e.getUtility("browser"),s=e.getUtility("subpx"),l=e.getConfig(),c=!1,u={},d=/<xhtml:link[^>]*>(\s*<\/xhtml:link>)?/i;return{get:function(e,t){var a,o=this.getURL(t);return u[t]?u[t]:(a=i.fetch(o,Oe.ASSET_REQUEST_RETRIES),u[t]=a.then(n).promise({abort:function(){a.abort(),u&&delete u[t]}}),u[t])},getURL:function(e){var t=o.template(l.template.svg,{page:e});return l.url+t+l.queryString},destroy:function(){c=!0,o=i=s=r=l=u=null}}}),Oe.addDataProvider("page-text",function(e){function t(e){if(!r){var t=a.countInStr(e,"<div");return t>n?"":e=e.replace(/<link rel="stylesheet".*/,"")}}var n=256,a=e.getUtility("common"),o=e.getUtility("ajax"),i=e.getConfig(),r=!1,s={};return{get:function(e,n){var a,i=this.getURL(n);return s[n]?s[n]:(a=o.fetch(i,Oe.ASSET_REQUEST_RETRIES),s[n]=a.then(t).promise({abort:function(){a.abort(),s&&delete s[n]}}),s[n])},getURL:function(e){var t=a.template(i.template.html,{page:e});return i.url+t+i.queryString},destroy:function(){r=!0,a=o=i=s=null}}}),Oe.addDataProvider("stylesheet",function(e){function t(e){return o.ie&&(e=e.replace(/font-family:[\s\"\']*([\w-]+)\b/g,"$0-"+i.id)),e}var n,a=e.getUtility("ajax"),o=e.getUtility("browser"),i=e.getConfig();return{get:function(){if(n)return n;var e=a.fetch(this.getURL(),Oe.ASSET_REQUEST_RETRIES);return n=e.then(t).promise({abort:function(){e.abort(),n=null}})},getURL:function(){var e=i.template.css;return i.url+e+i.queryString},destroy:function(){a=o=i=null,n=null}}}),Oe.addUtility("ajax",function(e){function n(e){var t,n,a;try{t=e.status,n=e.statusText,a=e.responseText}catch(o){t=0,n="",a=null}return{status:t,statusText:n,responseText:a,rawRequest:e}}function a(e){return"file:"===d.parse(e).protocol}function o(e){return e>=200&&300>e||304===e}function i(e){return e=c.extend(!0,{},e||{}),e.method=e.method||"GET",e.headers=e.headers||[],e.data=e.data||"","string"!=typeof e.data&&(e.data=t.param(e.data),"GET"!==e.method&&(e.data=e.data,e.headers.push(["Content-Type","application/x-www-form-urlencoded"]))),e}function r(e,t){var n;for(n=0;n<t.length;++n)e.setRequestHeader(t[n][0],t[n][1])}function s(e,t,n,i,s,l){var c=u.getXHR();return c.open(t,e,!0),c.onreadystatechange=function(){var t;if(4===c.readyState){c.onreadystatechange=function(){};try{t=c.status}catch(n){return void l(c)}0===t&&a(e)&&(t=200),o(t)?s(c):l(c)}},r(c,i),c.send(n),c}function l(e,t,n,a,o){var i=u.getXDR();try{i.open(t,e),i.onload=function(){a(i)},i.onerror=function(){o(i)},i.ontimeout=function(){o(i)},i.onprogress=function(){},i.send(n)}catch(r){return o({status:0,statusText:r.message})}return i}var c=e.getUtility("common"),u=e.getUtility("support"),d=e.getUtility("url");return{request:function(e,t){function a(e){return c.isFn(r.success)&&r.success.call(n(e)),e}function o(e){return c.isFn(r.fail)&&r.fail.call(n(e)),e}var r=i(t),f=r.method,g=r.data,p=r.headers;return"GET"===f&&g&&(e=d.appendQueryParams(e,g),g=""),u.isXHRSupported()?d.isCrossDomain(e)&&!u.isCORSSupported()?l(e,f,g,a,o):s(e,f,g,p,a,o):r.fail({status:0,statusText:"AJAX not supported"})},fetch:function(e,n){function a(e){n>0?(n--,i=o()):l.reject(e)}function o(){return s.request(e,{success:function(){var t,n;if(!r){if(n=this.rawRequest,202===this.status&&c.isFn(n.getResponseHeader)&&(t=parseInt(n.getResponseHeader("retry-after")),t>0))return void setTimeout(o,1e3*t);this.responseText?l.resolve(this.responseText):a({error:"empty response",status:this.status,resource:e})}},fail:function(){r||a({error:this.statusText,status:this.status,resource:e})}})}var i,r=!1,s=this,l=t.Deferred();return i=o(),l.promise({abort:function(){r=!0,i.abort()}})}}}),Oe.addUtility("browser",function(){var e,t=navigator.userAgent,n={},a=/ip(hone|od|ad)/i.test(t),o=/android/i.test(t),i=/blackberry/i.test(t),r=/webos/i.test(t),s=/silk|kindle/i.test(t),l=/MSIE|Trident/i.test(t);return l&&(n.ie=!0,e=/MSIE/i.test(t)?/MSIE\s+(\d+\.\d+)/i.exec(t):/Trident.*rv[ :](\d+\.\d+)/.exec(t),n.version=e&&parseFloat(e[1]),n.ielt9=n.version<9,n.ielt10=n.version<10,n.ielt11=n.version<11),a&&(n.ios=!0,e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n.version=e&&parseFloat(e[1]+"."+e[2])),n.mobile=/mobile/i.test(t)||a||o||i||r||s,n.firefox=/firefox/i.test(t),/safari/i.test(t)&&(n.chrome=/chrome/i.test(t),n.safari=!n.chrome),n.safari&&(e=navigator.appVersion.match(/Version\/(\d+(\.\d+)?)/),n.version=e&&parseFloat(e[1])),n}),Oe.addUtility("common",function(){var n=1.33333,a={};return a.extend=t.extend,a.each=t.each,a.map=t.map,a.param=t.param,a.parseJSON=t.parseJSON,a.stringifyJSON="undefined"!=typeof e.JSON?e.JSON.stringify:function(){throw new Error("JSON.stringify not supported")},t.extend(a,{bisectLeft:function(e,t,n){for(var a,o,i=0,r=e.length;r>i;)o=Math.floor((i+r)/2),a=n?e[o][n]:e[o],t>a?i=o+1:r=o;return i},bisectRight:function(e,t,n){for(var a,o,i=0,r=e.length;r>i;)o=Math.floor((i+r)/2),a=n?e[o][n]:e[o],a>t?r=o:i=o+1;return i},clamp:function(e,t,n){return t>e?t:e>n?n:e},sign:function(e){var t=parseInt(e,10);return t?0>t?-1:1:t},isFn:function(e){return"function"==typeof e},inArray:function(e,n){return a.isFn(n.indexOf)?n.indexOf(e):t.inArray(e,n)},constrainRange:function(e,t,n){var o=t-e;return 0>o?{min:-1,max:-1}:(e=a.clamp(e,0,n),t=a.clamp(e+o,0,n),o>t-e&&(e=a.clamp(t-o,0,n)),{min:e,max:t})},now:function(){return(new Date).getTime()},throttle:function(e,t){function n(){l=a.now(),r=null,s=t.apply(o,i)}var o,i,r,s,l=0;return function(){var c=a.now(),u=e-(c-l);return o=this,i=arguments,0>=u?(clearTimeout(r),r=null,l=c,s=t.apply(o,i)):r||(r=setTimeout(n,u)),s}},debounce:function(e,t){function n(){var c=a.now()-s;e>c?r=setTimeout(n,e-c):(r=null,l=t.apply(o,i),o=i=null)}var o,i,r,s,l;return function(){return o=this,i=arguments,s=a.now(),r||(r=setTimeout(n,e)),l}},insertCSS:function(e){var t=document.createElement("style"),n=document.createTextNode(e);try{t.setAttribute("type","text/css"),t.appendChild(n)}catch(a){}return document.getElementsByTagName("head")[0].appendChild(t),t},appendCSSRule:function(e,t,n){var a;return e.insertRule?e.insertRule(t+"{"+n+"}",e.cssRules.length):(a=e.addRule(t,n,e.rules.length),0>a&&(a=e.rules.length-1),a)},deleteCSSRule:function(e,t){e.deleteRule?e.deleteRule(t):e.removeRule(t)},getSelectedNode:function(){var t,n,a;return e.getSelection?(n=e.getSelection(),n.rangeCount&&(a=n.getRangeAt(0),a.collapsed||(t=n.anchorNode.parentNode))):document.selection&&(t=document.selection.createRange().parentElement()),t},getComputedStyle:function(t){return"getComputedStyle"in e?e.getComputedStyle(t):t.currentStyle},calculatePtSize:function(){var e,t,o=1e4,i=document.createElement("div");return i.style.display="block",i.style.position="absolute",i.style.width=o+"pt",document.body.appendChild(i),e=a.getComputedStyle(i),t=e&&e.width?parseFloat(e.width)/o:n,document.body.removeChild(i),t},countInStr:function(e,t){for(var n,a=0;n=e.indexOf(t,n)+1;)a++;return a},template:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e=e.replace(new RegExp("\\{\\{"+n+"\\}\\}","g"),t[n]));return e}})}),Oe.addUtility("subpx",function(n){function a(){if(!t.support.leadingWhitespace)return!1;var n=t(r.template(i,{size:12.5})).appendTo(document.documentElement).get(0),a=t(n).css("font-size"),o=t(n).width();t(n).remove(),n=t(r.template(i,{size:12.6})).appendTo(document.documentElement).get(0);var s=t(n).css("font-size"),l=t(n).width();if(t(n).remove(),!("ontouchstart"in e)){if(a===s)return!1;if(o===l)return!1}return!0}var o="crocodoc-subpx-fix",i='<span style="font:{{size}}px serif; color:transparent; white-space:nowrap;">'+new Array(100).join("A")+"</span>",r=n.getUtility("common"),s=a();return{fix:function(e){if(!s&&void 0!==document.body.style.zoom){var n=t("<div>").addClass(o);t(e).wrap(n)}return e},isSubpxSupported:function(){return s}}}),Oe.addUtility("support",function(){function t(e){var t,o,i,r=document.createElement("div");if(e in r.style)return e;if(t=e.charAt(0).toUpperCase()+e.substr(1),e in r.style)return e;for(o=0;o<a.length;++o)if(i=a[o]+t,i in r.style)return 0===i.indexOf("ms")&&(i="-"+i),n(i);return!1}function n(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}var a=["Moz","Webkit","O","ms"],o=null,i=null;return{svg:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),csstransform:t("transform"),csstransition:t("transition"),csszoom:t("zoom"),isXHRSupported:function(){return null===o&&(o=!!this.getXHR()),o},isCORSSupported:function(){return null===i&&(i=this.isXHRSupported()&&"withCredentials"in this.getXHR()),i},isXDRSupported:function(){return"undefined"!=typeof e.XDomainRequest},getXHR:function(){if(e.XMLHttpRequest)return new e.XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){return null}},getXDR:function(){return this.isXDRSupported()?new e.XDomainRequest:null}}}),Oe.addUtility("url",function(t){var n,a=t.getUtility("browser");return{getCurrentURL:function(){return e.location.href},makeAbsolute:function(e){return this.parse(e).href},isCrossDomain:function(e){var t=this.parse(e);return n||(n=this.parse(this.getCurrentURL())),t.hostname?t.protocol!==n.protocol||t.hostname!==n.hostname||t.port!==n.port:!1},appendQueryParams:function(e,t){return e.indexOf("?")>-1?e+"&"+t:e+"?"+t},parse:function(e){var t,n=document.createElement("a");return n.href=e,a.ie&&e!==n.href&&(e=n.href,n.href=e),t=n.pathname,/^\//.test(t)||(t="/"+t),{href:n.href,protocol:n.protocol,host:n.host,hostname:n.hostname,port:n.port,pathname:t,hash:n.hash,search:n.search}}}}),Oe.addComponent("controller-paged",function(e){function n(){var e=c.metadata;c.numPages=e.numpages,c.pageStart?c.pageStart<0&&(c.pageStart=e.numpages+c.pageStart):c.pageStart=1,c.pageStart=g.clamp(c.pageStart,1,e.numpages),c.pageEnd?c.pageEnd<0&&(c.pageEnd=e.numpages+c.pageEnd):c.pageEnd=e.numpages,c.pageEnd=g.clamp(c.pageEnd,c.pageStart,e.numpages),c.numPages=c.pageEnd-c.pageStart+1}function a(){var e,n,a,o,i,r,s,l,u=g.calculatePtSize(),d=c.metadata.dimensions,f="";for(c.pageScale=N/(d.width*u),a=c.zoomLevels[c.zoomLevels.length-1],o=3/c.pageScale;o>a;)a+=a/2,c.zoomLevels.push(a);for(d.exceptions=d.exceptions||{},e=c.pageStart-1;e<c.pageEnd;e++)n=e+1,n in d.exceptions?(i=d.exceptions[n].width,r=d.exceptions[n].height):(i=d.width,r=d.height),s=i*u,l=r*u,s*=c.pageScale,l*=c.pageScale,f+=g.template(Oe.pageTemplate,{w:s,h:l});c.$pages=t(f).appendTo(c.$doc)}function o(e){return c.conversionIsComplete||0===e&&c.autoloadFirstPage?ne:te}function i(){var t,n,a=[],i=c.pageStart-1,s=c.pageEnd,l=r();for(t=i;s>t;t++)n=e.createComponent("page"),n.init(c.$pages.eq(t-i),{index:t,status:o(t),enableLinks:c.enableLinks,links:l[t],pageScale:c.pageScale}),a.push(n);c.pages=a}function r(){var e,t,n,a,o=c.pageStart,i=c.pageEnd,r=c.metadata.links||[],s=[];for(e=0,t=c.metadata.numpages;t>e;++e)s[e]=[];for(e=0,t=r.length;t>e;++e)if(n=r[e],!(n.pagenum<o||n.pagenum>i)){if(n.destination){if(a=n.destination.pagenum,o>a||a>i)continue;n.destination.pagenum=a-(o-1)}s[n.pagenum-1].push(n)}return s}function s(){l()}function l(){var e=g.getSelectedNode(),n=t(e).closest("."+T);u.find("."+d).removeClass(d),e&&u.has(e)&&n.addClass(d)}var c,u,f,g=e.getUtility("common");return{init:function(){c=e.getConfig(),u=c.$el,t(document).on("mouseup",s),n(),a(),i(),f=e.createComponent("lazy-loader"),f.init(c.pages)},destroy:function(){t(document).off("mouseup",s)}}}),Oe.addComponent("controller-text",function(e){var n;return{init:function(){var a=e.getConfig();a.$textContainer=t(),n=e.get("page-text",1).then(function(e){var n=a.$doc.parent();a.$doc=t(e),n.html(a.$doc)})},destroy:function(){n.abort()}}}),Oe.addComponent("dragger",function(n){function a(e){r.scrollTop(s.top-(e.clientY-l.y)),r.scrollLeft(s.left-(e.clientX-l.x)),e.preventDefault()}function o(e){n.broadcast("dragend"),c.off("mousemove",a),c.off("mouseup",o),e.preventDefault()}function i(e){n.broadcast("dragstart"),s={top:r.scrollTop(),left:r.scrollLeft()},l={x:e.clientX,y:e.clientY},c.on("mousemove",a),c.on("mouseup",o),e.preventDefault()}var r,s,l,c=t(e);return{init:function(e){r=t(e),r.on("mousedown",i)},destroy:function(){r.off("mousedown",i),r.off("mousemove",a),c.off("mouseup",o)}}}),Oe.addComponent("layout-base",function(t){var n=t.getUtility("common");return{messages:["resize","scroll","scrollend"],onmessage:function(e,t){switch(e){case"resize":this.handleResize(t);break;case"scroll":this.handleScroll(t);break;case"scrollend":this.handleScrollEnd(t)}},init:function(){var e=t.getConfig();this.config=e,this.$el=e.$el,this.$doc=e.$doc,this.$viewport=e.$viewport,this.$pages=e.$pages,this.numPages=e.numPages,this.layoutClass=y+e.layout,this.$el.addClass(this.layoutClass),this.initState()},initState:function(){var t=this.$viewport[0],n=t;t===e&&(n=document.documentElement),this.state={scrollTop:t.scrollTop,scrollLeft:t.scrollLeft,viewportDimensions:{clientWidth:n.clientWidth,clientHeight:n.clientHeight,offsetWidth:n.offsetWidth,offsetHeight:n.offsetHeight},zoomState:{zoom:1,prevZoom:0,zoomMode:null},initialWidth:0,initialHeight:0,totalWidth:0,totalHeight:0},this.zoomLevels=[]},destroy:function(){this.$doc.removeAttr("style"),this.$el.removeClass(this.layoutClass)},setZoom:function(){},calculateNextZoomLevel:function(e){var t,n=!1,a=this.state.zoomState.zoom,o=this.zoomLevels;if(e===Oe.ZOOM_IN){for(t=0;t<o.length;++t)if(o[t]>a){n=o[t];break}}else if(e===Oe.ZOOM_OUT)for(t=o.length-1;t>=0;--t)if(o[t]<a){n=o[t];break}return n},isDraggable:function(){var e=this.state;return e.viewportDimensions.clientHeight<e.totalHeight||e.viewportDimensions.clientWidth<e.totalWidth},scrollBy:function(e,t){e=parseInt(e,10)||0,t=parseInt(t,10)||0,this.scrollToOffset(e+this.state.scrollLeft,t+this.state.scrollTop)},scrollToOffset:function(e,t){this.$viewport.scrollLeft(e),this.$viewport.scrollTop(t)},handleScroll:function(e){this.state.scrollTop=e.scrollTop,this.state.scrollLeft=e.scrollLeft},handleResize:function(){},handleScrollEnd:function(){},update:function(){},focus:function(){this.$viewport.focus()},extend:function(e){return n.extend({},this,e)}}}),Oe.addComponent("layout-"+Q,["layout-paged"],function(e,t){var n=e.getUtility("common"),a=e.getUtility("browser");return t.extend({calculateZoomAutoValue:function(){var e=this.state,t=this.calculateZoomValue(F),n=this.calculateZoomValue(q);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(t,n):a.mobile?n:Math.min(1,n)},calculateCurrentPage:function(){var e,t,a=this.state,o=a.pages;return e=n.bisectRight(o,a.scrollLeft,"x0")-1,t=n.bisectRight(o,a.scrollLeft+o[e].width/2,"x0")-1,1+t},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},handleResize:function(e){t.handleResize.call(this,e),this.updateCurrentPage()},handleScroll:function(e){t.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e=this.state,t=e.zoomState,n=t.zoom,a=e.sumWidths,o=Math.floor(e.tallestPage.totalActualHeight*n),i=Math.max(a,e.viewportDimensions.clientWidth),r=Math.max(o,e.viewportDimensions.clientHeight);this.$doc.css({height:r,lineHeight:r+"px",width:i})}})}),Oe.addComponent("layout-paged",["layout-base"],function(e,t){function n(e,t){var n,a,r,s,l=e.state,c="."+e.config.namespace+" ."+O,u=e.config.stylesheet,d=l.pages,f=t*e.config.pageScale,g=100/f;for(s=i.csstransform?i.csstransform+":scale("+f+");width:"+g+"%;height:"+g+"%;":i.csszoom?"zoom:"+f:"",l.previousStyleIndex&&o.deleteCSSRule(u,l.previousStyleIndex),l.previousStyleIndex=o.appendCSSRule(u,c,s),n=0,a=d.length;a>n;++n)r=d[n],e.$pages.eq(n).css({width:r.actualWidth*t,height:r.actualHeight*t,paddingTop:r.paddingTop*t,paddingRight:r.paddingRight*t,paddingBottom:r.paddingBottom*t,paddingLeft:r.paddingLeft*t})}function a(e,t){if(!t||0===t.length)return 1/0;var n=o.map(t,function(t){return e[t].y1});return Math.max.apply(Math,n)}var o=e.getUtility("common"),i=e.getUtility("support");return t.extend({init:function(){t.init.call(this),this.updatePageStates(),this.updateZoomLevels()},initState:function(){t.initState.call(this),o.extend(this.state,{pages:[],widestPage:{index:0,actualWidth:0},tallestPage:{index:0,actualHeight:0},sumWidths:0,sumHeights:0,rows:[],currentPage:null,visiblePages:[],fullyVisiblePages:[]})},destroy:function(){t.destroy.call(this),this.$pages.css("padding","")},update:function(){this.updatePageStates(!0),this.setZoom()},setZoom:function(t){var n,a,i=this.state,r=this.parseZoomValue(t),s=i.zoomState,l=s.zoom;n=this.calculateZoomMode(t,r),r=o.clamp(r,i.minZoom,i.maxZoom),e.broadcast("beforezoom",o.extend({page:i.currentPage,visiblePages:o.extend([],i.visiblePages),fullyVisiblePages:o.extend([],i.fullyVisiblePages)},s)),s.prevZoom=l,s.zoom=r,s.zoomMode=n,this.applyZoom(r),s.canZoomIn=this.calculateNextZoomLevel(Oe.ZOOM_IN)!==!1,s.canZoomOut=this.calculateNextZoomLevel(Oe.ZOOM_OUT)!==!1,this.updatePageStates(),this.updateLayout(),a=t===Oe.ZOOM_AUTO||t===Oe.ZOOM_FIT_WIDTH||t===Oe.ZOOM_FIT_HEIGHT,this.updateScrollPosition(a),this.updatePageStates(),this.updateVisiblePages(!0),e.broadcast("zoom",o.extend({page:i.currentPage,visiblePages:o.extend([],i.visiblePages),fullyVisiblePages:o.extend([],i.fullyVisiblePages),isDraggable:this.isDraggable()},s))},parseZoomValue:function(e){var t=parseFloat(e),n=this.state,a=n.zoomState,o=a.zoom,i=o;if(t)i=t;else switch(e){case Oe.ZOOM_FIT_WIDTH:case Oe.ZOOM_FIT_HEIGHT:case Oe.ZOOM_AUTO:i=this.calculateZoomValue(e);break;case Oe.ZOOM_IN:case Oe.ZOOM_OUT:i=this.calculateNextZoomLevel(e)||o;break;default:i=o?a.zoomMode?this.calculateZoomValue(a.zoomMode):o:this.calculateZoomValue(this.config.zoom||Oe.ZOOM_AUTO)}return i},calculateZoomMode:function(e,t){switch(t){case this.calculateZoomValue(Oe.ZOOM_AUTO):return"string"!=typeof e||e!==Oe.ZOOM_FIT_WIDTH&&e!==Oe.ZOOM_FIT_HEIGHT?Oe.ZOOM_AUTO:e;case this.calculateZoomValue(Oe.ZOOM_FIT_WIDTH):return Oe.ZOOM_FIT_WIDTH;case this.calculateZoomValue(Oe.ZOOM_FIT_HEIGHT):return Oe.ZOOM_FIT_HEIGHT;default:return null}},updateZoomLevels:function(){function e(e){var t=n/e;return e===n?!1:de>t?!0:o.inArray(e,l)>-1&&fe>t?!0:!1}var t,n,a=this.config.zoomLevels.slice()||[1],i=this.calculateZoomValue(Oe.ZOOM_AUTO),r=this.calculateZoomValue(Oe.ZOOM_FIT_WIDTH),s=this.calculateZoomValue(Oe.ZOOM_FIT_HEIGHT),l=[r,s];for(this.state.minZoom=this.config.minZoom||a[0],this.state.maxZoom=this.config.maxZoom||a[a.length-1],i!==r&&i!==s&&l.push(i),a=a.concat(l),a.sort(function(e,t){return e-t}),this.zoomLevels=[],n=0,t=0;t<a.length;++t)e(a[t])&&(n=a[t],this.zoomLevels.push(n))},calculateZoomValue:function(e){var t=this.state,n=parseFloat(e);return n?n:e===Oe.ZOOM_FIT_WIDTH?t.viewportDimensions.clientWidth/t.widestPage.totalActualWidth:e===Oe.ZOOM_FIT_HEIGHT?t.viewportDimensions.clientHeight/t.tallestPage.totalActualHeight:e===Oe.ZOOM_AUTO?this.calculateZoomAutoValue():t.zoomState.zoom},applyZoom:function(e){n(this,e)},scrollTo:function(e){var t=this.state,n=parseInt(e,10);if("string"==typeof e){if(e===Oe.SCROLL_PREVIOUS&&t.currentPage>1)n=this.calculatePreviousPage();else if(e===Oe.SCROLL_NEXT&&t.currentPage<this.numPages)n=this.calculateNextPage();else if(!n)return}else if(!n&&0!==n)return;n=o.clamp(n,1,this.numPages),this.scrollToPage(n)},scrollToPage:function(e){var t=this.calculateScrollPositionForPage(e);this.scrollToOffset(t.left,t.top)},calculateCurrentPage:function(){return this.state.currentPage},calculateScrollPositionForPage:function(e){var t=o.clamp(e-1,0,this.numPages-1),n=this.state.pages[t];return{top:n.y0,left:n.x0}},calculateVisibleRange:function(){var e=this.state,t=e.pages,n=e.viewportDimensions.clientHeight,a=e.viewportDimensions.clientWidth;if(0===a||0===n)return{min:-1,max:-1};var i=e.scrollTop,r=i+n,s=e.scrollLeft,l=s+a,c=o.bisectLeft(t,i,"y1"),u=o.bisectRight(t,r,"y0")-1,d=o.bisectLeft(t,s,"x1"),f=o.bisectRight(t,l,"x0")-1,g=Math.max(d,c),p=Math.min(f,u);return o.constrainRange(g,p,this.numPages-1)},calculateFullyVisibleRange:function(){var e=this.state,t=e.pages,n=e.viewportDimensions.clientHeight,a=e.viewportDimensions.clientWidth;if(0===a||0===n)return{min:-1,max:-1};var i=e.scrollTop,r=i+n,s=e.scrollLeft,l=s+a,c=o.bisectLeft(t,i,"y0"),u=o.bisectRight(t,r,"y1")-1,d=o.bisectLeft(t,s,"x0"),f=o.bisectRight(t,l,"x1")-1,g=Math.max(d,c),p=Math.min(f,u);return o.constrainRange(g,p,this.numPages-1)},setCurrentPage:function(t){var n=this.state;n.currentPage!==t?(n.currentPage=t,this.updateVisiblePages(),e.broadcast("pagefocus",{page:n.currentPage,numPages:this.numPages,visiblePages:o.extend([],n.visiblePages),fullyVisiblePages:o.extend([],n.fullyVisiblePages)})):this.updateVisiblePages()},updateVisiblePages:function(e){var t,n,a,o=this.state,i=this.calculateVisibleRange(),r=this.calculateFullyVisibleRange();for(o.visiblePages.length=0,o.fullyVisiblePages.length=0,t=0,n=this.$pages.length;n>t;++t)a=this.$pages.eq(t),t<i.min||t>i.max?e&&a.hasClass(U)&&a.removeClass(U):(e&&!a.hasClass(U)&&a.addClass(U),o.visiblePages.push(t+1)),t>=r.min&&t<=r.max&&o.fullyVisiblePages.push(t+1)},updatePageStates:function(e){var t,n,o,i,r,s=this.state,l=s.pages,c=s.rows,u=this.$viewport.scrollTop(),d=this.$viewport.scrollLeft(),f=0,g=0,p=0,h=0;for(c.length=s.sumWidths=s.sumHeights=s.totalWidth=s.totalHeight=0,s.widestPage.totalActualWidth=s.tallestPage.totalActualHeight=0,t=0,n=this.$pages.length;n>t;++t)r=this.$pages.eq(t),i=r[0],o=l[t],(!o||e)&&(r.css("padding",""),o={index:t,paddingLeft:parseFloat(r.css(ce)),paddingRight:parseFloat(r.css(le)),paddingTop:parseFloat(r.css(se)),paddingBottom:parseFloat(r.css(ue))}),o.actualWidth||(o.actualWidth=parseFloat(i.getAttribute("data-width"))),o.actualHeight||(o.actualHeight=parseFloat(i.getAttribute("data-height"))),o.totalActualWidth=o.actualWidth+o.paddingLeft+o.paddingRight,o.totalActualHeight=o.actualHeight+o.paddingTop+o.paddingBottom,o.width=i.offsetWidth,o.height=i.offsetHeight,o.x0=i.offsetLeft,o.y0=i.offsetTop,o.x1=o.width+o.x0,o.y1=o.height+o.y0,g&&a(l,c[f])<=o.y0+2&&f++,g=o.y1,c[f]||(c[f]=[]),o.totalActualWidth>s.widestPage.totalActualWidth&&(s.widestPage=o),o.totalActualHeight>s.tallestPage.totalActualHeight&&(s.tallestPage=o),s.sumWidths+=o.width,s.sumHeights+=o.height,o.rowIndex=f,l[t]=o,c[f].push(t),l[p].x0+l[p].width<o.x0+o.width&&(p=t),l[h].y0+l[h].height<o.y0+o.height&&(h=t);s.totalWidth=l[p].x0+l[p].width,s.totalHeight=l[h].y0+l[h].height,s.scrollTop=u,s.scrollLeft=d,this.setCurrentPage(this.calculateCurrentPage())},updateCurrentPage:function(){var e=this.calculateCurrentPage();this.setCurrentPage(e)},handleResize:function(e){var t=this.state.zoomState.zoomMode;this.state.viewportDimensions=e,this.updateZoomLevels(),this.setZoom(t)},handleScrollEnd:function(e){this.$doc.find("."+b).removeClass(b),this.$pages.eq(this.state.currentPage-1).addClass(b),this.updateVisiblePages(!0),this.handleScroll(e)},updateScrollPosition:function(e){var t,n,a=this.state,o=a.zoomState,i=o.zoom/o.prevZoom;t=a.scrollLeft*i,n=a.scrollTop*i,e!==!0&&(n+=a.viewportDimensions.offsetHeight*(i-1)/2,t+=a.viewportDimensions.offsetWidth*(i-1)/2),this.scrollToOffset(t,n)},updateLayout:function(){},calculateZoomAutoValue:function(){return 1},calculateNextPage:function(){return 1},calculatePreviousPage:function(){return 1}})}),Oe.addComponent("layout-"+K,["layout-"+J],function(e,t){var n=e.getUtility("common");
return t.extend({init:function(){this.twoPageMode=!0,t.init.call(this)},calculateNextPage:function(){return this.state.currentPage+2},calculatePreviousPage:function(){return this.state.currentPage-2},calculateZoomValue:function(e){var n=t.calculateZoomValue.call(this,e);return e===F&&(n/=2),n},scrollToPage:function(e){t.scrollToPage.call(this,e-(e+1)%2)},calculateVisibleRange:function(){var e=this.state.currentPage-1,t=e+1;return n.constrainRange(e,t,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()}})}),Oe.addComponent("layout-"+J,["layout-paged"],function(e,t){var n=e.getUtility("common");return t.extend({init:function(){t.init.call(this),this.updatePageMargins(),this.updatePageClasses()},destroy:function(){t.destroy.call(this),this.$pages.css({margin:"",left:""}).removeClass(H)},calculateZoomAutoValue:function(){var e=this.calculateZoomValue(F),t=this.calculateZoomValue(q);return Math.min(e,t)},calculateCurrentPage:function(){return this.state.currentPage},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},calculateVisibleRange:function(){var e=this.state.currentPage-1;return n.constrainRange(e,e,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()},setCurrentPage:function(e){var a,o,i=n.clamp(e-1,0,this.numPages);t.setCurrentPage.call(this,e),this.$doc.find("."+w).removeClass(w),a=this.$doc.find("."+b),o=this.$pages.eq(i),a[0]!==o[0]&&(a.addClass(w).removeClass(b),o.addClass(b)),this.updateVisiblePages(!0),this.updatePageClasses(i)},scrollToPage:function(e){this.setCurrentPage(e)},updateLayout:function(){var e,t,n,a,o,i,r,s=this.state,l=s.zoomState,c=l.zoom,u=this.currentPage||1,d=s.pages[u-1],f=this.twoPageMode?s.pages[u]:d,g=s.viewportDimensions.clientWidth,p=s.viewportDimensions.clientHeight;e=f.actualWidth,t=d.actualWidth+(this.twoPageMode?e:0),n=d.actualHeight,a=Math.floor((t+d.paddingLeft+f.paddingRight)*c),o=Math.floor(d.totalActualHeight*c),i=Math.max(a,g),r=Math.max(o,p),this.$doc.css({width:i,height:r}),this.updatePageMargins(),i>g||r>p?this.$el.addClass("crocodoc-scrollable"):this.$el.removeClass("crocodoc-scrollable")},updatePageMargins:function(){var e,t,n,a,o,i,r,s,l,c=this.state,u=c.viewportDimensions.clientWidth,d=c.viewportDimensions.clientHeight;for(e=0,t=this.$pages.length;t>e;++e)a=this.$pages.eq(e),n=c.pages[e],l=this.twoPageMode?e%2===1?n.paddingRight:n.paddingLeft:n.paddingRight+n.paddingLeft,o=(n.actualWidth+l)*c.zoomState.zoom,i=(n.actualHeight+n.paddingTop+n.paddingBottom)*c.zoomState.zoom,this.twoPageMode?(r=Math.max(0,(u-2*o)/2),e%2===1&&(r+=o)):r=(u-o)/2,s=(d-i)/2,r=Math.max(r,0),s=Math.max(s,0),a.css({marginLeft:r,marginTop:s})},updatePageClasses:function(){var e=this.$pages,t=this.state.currentPage-1,n=t+1,a=t-1,o=20;e.removeClass(H),this.twoPageMode?(n=t+2,a=t-2,e.slice(Math.max(a,0),t).addClass(z),e.slice(n,n+2).addClass(Z)):(a>=0&&e.eq(a).addClass(z),n<this.numPages&&e.eq(n).addClass(Z)),e.slice(0,t).addClass(A),e.slice(Math.max(0,t-o),t).addClass(M),e.slice(n).addClass(k),e.slice(n,Math.min(this.numPages,n+o)).addClass(I)}})}),Oe.addComponent("layout-"+ee,["layout-base"],function(e,t){var n=e.getUtility("common");return t.extend({init:function(){t.init.call(this),this.zoomLevels=this.config.zoomLevels.slice(),this.minZoom=this.zoomLevels[0],this.maxZoom=this.zoomLevels[this.zoomLevels.length-1]},setZoom:function(t){var a,o=this.state.zoomState,i=o.zoom;"string"==typeof t?(a=this.calculateNextZoomLevel(t),a||(a="auto"===t||"fitwidth"===t||"fitheight"===t?1:i)):a=parseFloat(t)||i,a=n.clamp(a,this.minZoom,this.maxZoom),this.config.$doc.css("font-size",10*a+"pt"),o.prevZoom=i,o.zoom=a,o.canZoomIn=this.calculateNextZoomLevel(Oe.ZOOM_IN)!==!1,o.canZoomOut=this.calculateNextZoomLevel(Oe.ZOOM_OUT)!==!1,e.broadcast("zoom",n.extend({isDraggable:this.isDraggable()},o))}})}),Oe.addComponent("layout-"+Y,["layout-"+B],function(e,t){return t}),Oe.addComponent("layout-"+B,["layout-paged"],function(e,t){var n=e.getUtility("common"),a=e.getUtility("browser");return t.extend({calculateZoomAutoValue:function(){var e=this.state,t=this.calculateZoomValue(F),n=this.calculateZoomValue(q);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(1,t,n):a.mobile?t:Math.min(1,t)},calculateCurrentPage:function(){var e,t,a,o,i,r=this.state,s=r.pages;return e=n.bisectRight(s,r.scrollTop,"y0")-1,0>e?1:(i=r.scrollTop+s[e].height/2,t=n.bisectRight(s,i,"y0")-1,a=s[t].rowIndex,o=r.rows[a],1+o[0])},calculateNextPage:function(){var e=this.state,t=e.pages[e.currentPage-1],n=t.rowIndex,a=e.rows[n+1];return a&&a[0]+1||e.currentPage},calculatePreviousPage:function(){var e=this.state,t=e.pages[e.currentPage-1],n=t.rowIndex,a=e.rows[n-1];return a&&a[0]+1||e.currentPage},handleResize:function(e){t.handleResize.call(this,e),this.updateCurrentPage()},handleScroll:function(e){t.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e,t,n=this.state,a=n.zoomState.zoom;e=Math.floor(n.widestPage.totalActualWidth*a),t=e<=n.viewportDimensions.clientWidth?"auto":e,this.$doc.css({width:t})}})}),Oe.addComponent("lazy-loader",function(e){function n(e){e=e||P;var t=C.page-1,n=t-e,a=t+e;return y.constrainRange(n,a,p-1)}function a(){var e;clearTimeout(v),T.length>0?(e=T.shift(),g[e]?w.loadPage(e,function(e){e===!1?a():v=setTimeout(a,ge)}):a()):i()}function o(){clearTimeout(v),S=!1,v=setTimeout(a,ge)}function i(){clearTimeout(v),S=!0}function r(e){T.push(e),S&&o()}function s(){T.length=0,i()}function l(e,t){var a=n(t);return e>=a.min&&e<=a.max?!0:!1}function c(e){var t=g[e];if(t){if(l(e))return!0;if(d(e))return!0}return!1}function u(e,t){return l(e,t)?!1:d(e)?!1:!0}function d(e){return y.inArray(e+1,C.visiblePages)>-1}function f(e,t){for(var n=y.sign(t-e);e!==t;)w.queuePageToLoad(e),e+=n;w.queuePageToLoad(e)}var g,p,h,m,v,y=e.getUtility("common"),b=e.getUtility("browser"),w={},T=[],P=1,S=!0,_=1,x=!1,C={page:1,visiblePages:[1]};return y.extend(w,{messages:["beforezoom","pageavailable","pagefocus","ready","scroll","scrollend","zoom"],onmessage:function(e,t){switch(e){case"beforezoom":this.handleBeforeZoom(t);break;case"pageavailable":this.handlePageAvailable(t);break;case"pagefocus":this.handlePageFocus(t);break;case"ready":this.handleReady();break;case"scroll":this.handleScroll();break;case"scrollend":this.handleScrollEnd();break;case"zoom":this.handleZoom(t)}},init:function(e){g=e,p=g.length,P=b.mobile||b.ielt10?he:pe,P=Math.min(P,p)},destroy:function(){this.cancelAllLoading()},updateLayoutState:function(e){_=y.sign(e.page-C.page),C=e},loadNecessaryPages:y.debounce(100,function(){this.cancelAllLoading(),this.queuePageToLoad(C.page-1),this.loadVisiblePages(),this.loadPagesInRange(P)}),loadPagesInRange:function(e){var t=C.page-1;e>0&&(e=n(e),_>=0?(f(t+1,e.max),f(t-1,e.min)):(f(t-1,e.min),f(t+1,e.max)))},loadVisiblePages:function(){var e,t;for(e=0,t=C.visiblePages.length;t>e;++e)this.queuePageToLoad(C.visiblePages[e]-1)},queuePageToLoad:function(e){c(e)&&(g[e].preload(),r(e))},cancelAllLoading:function(){clearTimeout(m),clearTimeout(h),s()},loadPage:function(e,n){t.when(g[e]&&g[e].load()).always(n)},unloadPage:function(e){var t=g[e];t&&t.unload()},unloadUnnecessaryPages:function(e){var t,n;for(t=0,n=g.length;n>t;++t)u(t,e)&&this.unloadPage(t)},handleReady:function(){x=!0,this.loadVisiblePages(),m=setTimeout(function(){w.loadNecessaryPages()},me)},handlePageAvailable:function(e){if(x){var t;if(e.all===!0&&(e.upto=p),e.page)this.queuePageToLoad(e.page-1);else if(e.upto)for(t=0;t<e.upto;++t)this.queuePageToLoad(t)}},handlePageFocus:function(e){this.updateLayoutState(e),x&&(this.cancelAllLoading(),h=setTimeout(function(){w.loadNecessaryPages()},200))},handleBeforeZoom:function(e){x&&(this.cancelAllLoading(),this.unloadUnnecessaryPages(2*e.visiblePages.length))},handleZoom:function(e){this.updateLayoutState(e),x&&this.loadNecessaryPages()},handleScroll:function(){this.cancelAllLoading()},handleScrollEnd:function(){x&&(this.loadNecessaryPages(),this.unloadUnnecessaryPages(P))}})}),Oe.addComponent("page-img",function(e){var n,a,o,i,r=e.getUtility("browser"),s=!1,l=r.mobile;return{init:function(e,n){a=t(e),i=n},destroy:function(){l=!0,this.unload(),a.empty()},prepare:function(){},preload:function(){o||(o=e.get("page-img",i))},load:function(){return this.preload(),o.done(function(e){s||(s=!0,n=t(e).appendTo(a))}),o.fail(function(t){s=!1,t&&e.broadcast("asseterror",t)}),o},unload:function(){o&&(o.abort(),o=null),l&&(n&&(n.remove(),n=null),s=!1)}}}),Oe.addComponent("page-links",function(e){function n(e){var n=t("<a>").addClass(C),r=e.bbox[0],s=e.bbox[1],l={};if(i.ie&&t("<span>").appendTo(n).on("click",a),n.css({left:r+"pt",top:s+"pt",width:e.bbox[2]-r+"pt",height:e.bbox[3]-s+"pt"}),e.uri){if(!/^http|^mailto/.test(e.uri))return;l.href=encodeURI(e.uri),l.target="_blank"}else e.destination&&(l.href="#page-"+e.destination.pagenum);n.attr(l),n.data("link",e),n.appendTo(o)}function a(n){var a=i.ie?n.target.parentNode:n.target,o=t(a),r=o.data("link");r&&e.broadcast("linkclick",r),n.preventDefault()}var o,i=e.getUtility("browser");return{init:function(e,n){o=t(e),this.createLinks(n),i.ie||o.on("click","."+C,a)},destroy:function(){o.empty().off("click"),o=i=null},createLinks:function(e){var t,a;for(t=0,a=e.length;a>t;++t)n(e[t])}}}),Oe.addComponent("page-svg",function(n){function a(){switch(T){case we:case Ce:return t("<iframe>");case xe:case Te:return t("<object>").attr({type:ve,data:"data:"+ve+";base64,"+e.btoa(be)});case Pe:return t("<div>");case Se:return t("<object>");case _e:case Le:return t("<img>")}}function o(){u&&0!==u.length||(y=!1,u=a()),0===u.parent().length&&u.appendTo(d)}function i(){return y||T===Se||T===_e?t.Deferred().resolve().promise({abort:function(){}}):n.get("page-svg",g)}function r(e){var t=e.querySelectorAll("use");[].forEach.call(t,function(t){var n=t.getAttribute("xlink:href"),a=e.querySelector(n).cloneNode(),o=t.parentNode;a.removeAttribute("id"),a.setAttribute("transform",t.getAttribute("transform")),o.replaceChild(a,t)})}function s(t){var a,o,i,s,l,c=u[0].contentDocument,d=u[0].contentWindow||c&&c.defaultView;switch(T){case we:p.ielt10&&(t=t.replace(/<xhtml:link.*/,"")),s=ye+t,p.ielt10?c.body.innerHTML=s:(c.documentElement.innerHTML=s,(p.ios||p.safari)&&p.version<7&&r(c)),i=c.getElementsByTagName("svg")[0];break;case Ce:c.documentElement.innerHTML=ye;var f=c.getElementsByTagName("head")[0]||c.documentElement,m=c.createElement("script"),v="("+proxySVG+")()";m.type="text/javascript";try{m.appendChild(document.createTextNode(v))}catch(y){m.text=v}return f.insertBefore(m,f.firstChild),void("complete"===c.readyState?d.loadSVG(t):d.onload=function(){this.loadSVG(t)});case Te:a=new h,o=a.parseFromString(t,ve),i=c.importNode(o.documentElement,!0),c.documentElement.appendChild(i);break;case xe:d.loadSVG(t),i=c.querySelector("svg");break;case Pe:a=new h,o=a.parseFromString(t,ve),i=document.importNode(o.documentElement,!0),u.append(i);break;case Se:u.attr({type:ve,data:n.getDataProvider("page-svg").getURL(g)}),i=u[0];break;case _e:i=u[0],i.src=n.getDataProvider("page-svg").getURL(g);break;case Le:i=u[0],l="data:"+ve,i.src=!p.ie&&e.btoa?l+";base64,"+e.btoa(t):l+","+encodeURIComponent(t)}i.setAttribute("width","100%"),i.setAttribute("height","100%")}function l(e){m||v||(!y&&e&&(s(e),y=!0,w||(f.abort(),f=null)),0===u.parent().length&&u.appendTo(d))}function c(e){n.broadcast("asseterror",e),y=!1,f&&f.abort()}var u,d,f,g,p=n.getUtility("browser"),h=e.DOMParser,m=!1,v=!1,y=!1,b=n.getConfig(),w=p.mobile||p.ielt10,T=p.ielt11||p.firefox?Le:we;return{init:function(e,t){d=e,g=t,T=b.embedStrategy||T},destroy:function(){m=!0,w=!0,this.unload(),d.empty()},prepare:function(){o()},preload:function(){this.prepare(),f||(f=i())},load:function(){return v=!1,this.preload(),f.done(l).fail(c),f},unload:function(){v=!0,f&&"resolved"!==f.state()&&(f.abort(),f=null),w&&(u&&(u.remove(),u=null),y=!1)}}}),Oe.addComponent("page-text",function(e){function n(){return g.enableTextSelection&&!c.ielt9}function a(e){var t,n;!e||f||d||(f=!0,t=document.implementation.createHTMLDocument(""),t.getElementsByTagName("body")[0].innerHTML=e,e=null,n=document.importNode(t.querySelector("."+x),!0),r.attr("class",n.getAttribute("class")),r.html(n.innerHTML),u.fix(r))}function o(t){t&&e.broadcast("asseterror",t)}function i(){return s||(s=n()?e.get("page-text",l):t.Deferred().resolve().promise({abort:function(){}})),s}var r,s,l,c=e.getUtility("browser"),u=e.getUtility("subpx"),d=!1,f=!1,g=e.getConfig();return{init:function(e,t){r=e,l=t},destroy:function(){d=!0,this.unload(),r.empty()},preload:function(){i()},load:function(){return i().done(a).fail(o)},unload:function(){s&&"resolved"!==s.state()&&(s.abort(),s=null)},enable:function(){r.css("display",""),s&&!f&&(s=null)},disable:function(){r.css("display","none")}}}),Oe.addComponent("page",function(e){var n,a,o,i,r,s,l,c,u=e.getUtility("support"),d=e.getUtility("common"),f=!1;return{messages:["pageavailable","pagefocus","textenabledchange","zoom"],onmessage:function(e,t){switch(e){case"pageavailable":(t.page===s+1||t.upto>s||t.all===!0)&&c===te&&(c=ne);break;case"textenabledchange":t.enabled===!0?this.enableTextSelection():this.disableTextSelection();break;case"pagefocus":case"zoom":l=r===t.page||d.inArray(r,t.visiblePages)>-1}},init:function(t,l){var d,f,g;n=t,f=t.find("."+_),d=t.find("."+x),g=t.find("."+L),c=l.status||ne,s=l.index,r=s+1,this.config=l,l.url=l.url||"",a=e.createComponent("page-text"),o=e.createComponent(u.svg?"page-svg":"page-img"),a.init(d,r),o.init(f,r),l.enableLinks&&l.links.length&&(i=e.createComponent("page-links"),i.init(g,l.links))},destroy:function(){this.unload()},preload:function(){o.prepare(),c===ne&&(o.preload(),a.preload())},load:function(){var i=this;return f=!0,c===ie?!1:c===te?!1:(c!==oe&&(c=ae),t.when(o.load(),a.load()).done(function(){f?c!==oe&&(n.removeClass(R),c=oe,e.broadcast("pageload",{page:r})):i.unload()}).fail(function(t){c=ie,n.addClass(E),e.broadcast("pagefail",{page:s+1,error:t})}))},unload:function(){f=!1,o.unload(),a.unload(),c===oe&&(c=ne,n.addClass(R),n.removeClass(E),e.broadcast("pageunload",{page:r}))},enableTextSelection:function(){a.enable(),l&&a.load()},disableTextSelection:function(){a.disable()}}}),Oe.addComponent("resizer",function(n){function a(){n.broadcast("resize",{width:u,height:d,clientWidth:l,clientHeight:c,offsetWidth:u,offsetHeight:d})}function o(){var e=f.getComputedStyle(s);e&&"static"===e.position&&t(s).css({position:"relative"})}function i(){var e=t('<iframe frameborder="0">'),n=t("<div>");e.add(n).css({opacity:0,visiblility:"hidden",position:"absolute",width:"100%",height:"100%",top:0,left:0,border:0}),e.prependTo(n.prependTo(s)),o(),p=t(e[0].contentWindow),p.on("resize",r)}function r(){var t=s.offsetHeight,i=s.offsetWidth;return v&&0===m&&0!==e.innerWidth?(m=e.innerWidth,o(),void n.broadcast("layoutchange")):void(t&&(t!==d||i!==u)&&(d=t,u=i,c=s.clientHeight,l=s.clientWidth,a()))}var s,l,c,u,d,f=n.getUtility("common"),g=[""," webkit"," moz"," "].join("fullscreenchange")+"MSFullscreenChange",p=t(e),h=t(document),m=0,v=function(){try{return e.self!==e.top}catch(t){return!0}}();return{messages:["layoutchange"],onmessage:function(){d=null,r()},init:function(n){s=t(n).get(0),s===e?(s=document.documentElement,p.on("resize",r)):i(),h.on(g,r),r()},destroy:function(){h.off(g,r),p.off("resize",r)}}}),Oe.addComponent("scroller",function(e){function n(){return{scrollTop:c.scrollTop(),scrollLeft:c.scrollLeft()}}function a(){v=!1,P=null,clearTimeout(u),e.broadcast("scrollend",n())}function o(){v||(v=!0,e.broadcast("scrollstart",n())),clearTimeout(u),u=setTimeout(a,m),S()}function i(){y=!0,b=!1,w=!1,o()}function r(){w=!0,o()}function s(){y=!1,b=!0,T=(new Date).getTime(),w&&l()}function l(){return clearTimeout(u),null===P&&(P=(new Date).getTime()),(new Date).getTime()-P>g?void a():(S(),void(u=setTimeout(l,p)))}var c,u,d=e.getUtility("common"),f=e.getUtility("browser"),g=3e3,p=30,h=200,m=f.mobile?500:250,v=!1,y=!1,b=!1,w=!1,T=0,P=null,S=d.throttle(h,function(){e.broadcast("scroll",n())});return{init:function(e){c=t(e),c.on("scroll",o),c.on("touchstart",i),c.on("touchmove",r),c.on("touchend",s)},destroy:function(){clearTimeout(u),c.off("scroll",o),c.off("touchstart",i),c.off("touchmove",r),c.off("touchend",s)}}}),Oe.addComponent("viewer-base",function(n){function a(){P.attr(o,T.metadata.version||"0.0.0"),E.mobile&&P.addClass(p),E.ielt9&&P.addClass(h),U.svg&&P.addClass(m)}function l(){P.html(Oe.viewerTemplate),T.useWindowAsViewport?(T.$viewport=t(e),P.addClass(v)):T.$viewport=P.find("."+s),T.$doc=P.find("."+r)}function d(){var e,t,a=T.plugins||{};for(e in a)t=n.createComponent("plugin-"+e),t&&R.isFn(t.init)&&t.init(T.plugins[e])}function f(){a(),x=n.createComponent("scroller"),x.init(T.$viewport),C=n.createComponent("resizer"),C.init(T.$viewport);var e;switch(T.metadata.type){case"text":e=n.createComponent("controller-text"),T.layout=ee;break;case"paged":default:e=n.createComponent("controller-paged")}e.init(),"text"===T.metadata.type?T.enableTextSelection||w.disableTextSelection():E.ielt9&&w.disableTextSelection(),(!T.enableLinks||E.ielt9)&&w.disableLinks(),w.setLayout(T.layout),n.broadcast("ready",{page:T.page||1,numPages:T.numPages}),n.ready()}function g(t){var n=w.fire("linkclick",t);n.isDefaultPrevented()||(t.uri?e.open(t.uri):t.destination&&w.scrollTo(t.destination.pagenum))}function y(e){e?L||(P.addClass(c),L=n.createComponent("dragger"),L.init(T.$viewport)):L&&(P.removeClass(c),n.destroyComponent(L),L=null)}function b(){var e;T.queryParams&&(e="string"==typeof T.queryParams?T.queryParams.replace(/^\?/,""):R.param(T.queryParams)),T.queryString=e?"?"+e:""}var w,T,P,S,_,x,C,L,O,R=n.getUtility("common"),E=n.getUtility("browser"),U=n.getUtility("support");return{messages:["asseterror","destroy","dragend","dragstart","fail","layoutchange","linkclick","pagefail","pagefocus","pageload","pageunload","ready","resize","scrollstart","scrollend","zoom"],onmessage:function(e,t){switch(e){case"layoutchange":w.updateLayout();break;case"linkclick":g(t);break;case"zoom":t.zoom*=T.pageScale,t.prevZoom*=T.pageScale,T.enableDragging&&y(t.isDraggable),w.fire(e,t);break;case"dragstart":P.hasClass(u)||P.addClass(u),w.fire(e,t);break;case"dragend":P.hasClass(u)&&P.removeClass(u),w.fire(e,t);break;default:w.fire(e,t)}},init:function(){if(T=n.getConfig(),w=T.api,T.namespace=i+"-"+T.id,P=T.$el,P.addClass(i),P.addClass(T.namespace),!T.url)throw new Error("no URL given for viewer assets");/\/$/.test(T.url)||(T.url+="/"),T.url=n.getUtility("url").makeAbsolute(T.url),b(),l(),d()},destroy:function(){P.empty().removeClass(function(e,t){var n=t.match(new RegExp("crocodoc\\S+","g"));return n&&n.join(" ")}),t(S).remove(),O&&O.abort()},setLayout:function(e){var t,a=T.page,o=T.zoom||1,i=T.layout;if(_){if(e===i)return _;a=_.state.currentPage,o=_.state.zoomState}if(t=n.createComponent("layout-"+e),!t)throw new Error("Invalid layout "+e);return _&&n.destroyComponent(_),T.layout=e,_=t,_.init(),_.setZoom(o.zoomMode||o.zoom||o),R.isFn(_.scrollTo)&&_.scrollTo(a),T.currentLayout=_,n.broadcast("layoutchange",{previousLayout:i,layout:e}),_},loadAssets:function(){var e,a,o,i;O||(a=n.get("metadata"),a.then(function(e){T.metadata=e}),E.ielt9?(S=R.insertCSS(""),T.stylesheet=S.styleSheet,e=t.when("").promise({abort:function(){}})):(e=n.get("stylesheet"),e.then(function(e){S=R.insertCSS(e),T.stylesheet=S.sheet})),!T.autoloadFirstPage||T.pageStart&&1!==T.pageStart||(U.svg?o=n.get("page-svg",1):T.conversionIsComplete&&(o=n.get("page-img",1)),T.enableTextSelection&&(i=n.get("page-text",1))),O=t.when(a,e).fail(function(e){O&&O.abort(),n.ready(),n.broadcast("asseterror",e),n.broadcast("fail",e)}).then(f).promise({abort:function(){O=null,a.abort(),e.abort(),o&&o.abort(),i&&i.abort()}}))}}}),Oe})}("undefined"!=typeof window?window:this),define("crocodoc.viewer.min",function(){}),define("player",["require","jquery","jade","log","framework","./crocodoc.viewer.min"],function(e){function t(e){return"content-area-"+e}function n(e){var t=y[e];return t?t:(m.error('no viewer found for content-area "'+e+'"'),null)}function a(){p("#widget-tabs").on("click",".content-player-outer .content-menu ul li.content-page-nav",function(e){o(e)}),p("#widget-tabs").on("click",".content-player-outer .content-menu ul li.content-layout-toggle",function(e){s(e)}),p("#widget-tabs").on("click",".content-player-outer .content-preview-menu ul li.content-share",function(e){u(e)}),p("#widget-tabs").on("click",".content-player-outer .content-preview-menu ul li.content-preview-close",function(e){l(e)}),p("#widget-tabs").on("click",".content-player-outer .content-menu ul li.content-library",function(e){c(e)})}function o(e){var t=p(e.currentTarget),a=t.closest("ul").attr("data-content-area-id"),o=(t.closest(".content-player-outer"),n(a));if(o){var i=t.attr("data-nav-direction");i="next"===i?Crocodoc.SCROLL_NEXT:Crocodoc.SCROLL_PREVIOUS,o.handle.scrollTo(i)}}function i(e,t){var n=e.find(".content-player-outer"),a=t.data.page;if("yes"===n.attr("data-is-shared")){var o=e.attr("data-tab-uuid"),i={uuid:o,page:a};h.send_info("*","navigate-to",i,0)}}function r(e,t,n){var a=this;if("yes"===e.attr("data-is-shared")){var o=a.attr("data-tab-uuid");m.info("viewer",t.handle);var i={uuid:o,scroll_to:n.data,zoom:t.getZoom()};h.send_info("*","scroll-to",i,0)}}function s(e){var t=p(e.currentTarget),a=t.closest("ul").attr("data-content-area-id"),o=n(a);o&&(T=(T+1)%w.length,o.handle.setLayout(w[T].layout),p(e.currentTarget).find("span.tooltip-text").html(w[T].tooltip))}function l(e){var t=p(e.currentTarget),a=t.closest("ul").attr("data-content-area-id"),o=n(a);o&&d(a,o,t.closest(".tab-pane"),!0)}function c(e){var t=p(e.currentTarget),n=t.closest(".tab-pane");f(n,"fullview-with-library")}function u(e){var t=p(e.currentTarget),n=t.closest(".tab-pane"),a=n.attr("data-tab-uuid"),o=t.closest(".content-player-outer"),i={uuid:n.attr("data-tab-uuid"),content_uri:o.attr("data-content-url")};h.send_info("*","new-content",i,0),h.tabs.sync_remote({uuid:a}),f(n,"fullview"),o.attr("data-is-shared","yes")}function d(e,t,n,a){try{t.handle.destroy()}catch(o){m.info("crocodoc destroy viewer exception ",o)}delete y[e],n.find(".content-player-outer").empty(),n.find(".content-player-outer").remove(),a&&f(n,null)}function f(e,t){t&&e.addClass("content-"+t);for(var n in P)n!=t&&e.removeClass("content-"+n)}function g(e,t,n){try{switch(m.info("scroll info",t),t.type){case"page":e.scrollTo(t.data||1);break;case"scroll_to":e.scrollToOffset(t.data.scroll_to.scrollLeft,t.data.scroll_to.scrollTop,t.data.zoom)}}catch(a){m.info("unable to scroll ["+n+"]: reason : ",a)}}var p=e("jquery");window.jade=e("jade");var h,m=e("log")("content-player","info"),v=(e("framework"),e("./crocodoc.viewer.min"),{}),y={},b="https://boxcontent.s3.amazonaws.com/9a99bc2a1dde42698e1e6bab105193ab";v.init=function(e,t,n,o){return h=o,a(),Crocodoc.addPlugin("scrolltooffset",function(e){var t=e.getConfig();return{init:function(n){var a=e.getConfig().api;a.getZoom=function(){var e=t.currentLayout,n=e.state.zoomState.zoom;return n},a.scrollToOffset=function(e,n,a){var o=t.currentLayout,i=o.state.zoomState.zoom;m.info("scrollToOffset: ",e,n,a,i),o.scrollToOffset(e*i/a,n*i/a)}}}}),!0},v.start=function(e,n,a){var o,s=p(e),l=s.attr("id"),c=p.Deferred();f(s,"loading"),v.destroy(s);var u=h.template("player"),d=t(l);s.append(u({content_area_id:d,content_uri:n,show_menu:a.show_menu,shared:a.shared&&(a.shared?"yes":"no")||"no"}));var w=s.find(".content-area");return n||(m.error("null content_uri"),n=b),o=Crocodoc.createViewer(w,{url:n,enableDragging:!1,plugins:{scrolltooffset:{}}}),o.load(),y[d]={handle:o},o.on("asseterror",function(e){m.error("content asseterror  = ",e),c.reject(e)}),o.on("fail",function(e){m.error("content failed to load  = ",e),c.reject(e)}),o.on("ready",function(e){m.info("viewer ready : data = ",e.data);try{o.setLayout(Crocodoc.LAYOUT_VERTICAL_SINGLE_COLUMN)}catch(t){}var i=a.mode?a.mode:"fullview";f(s,i),a.scroll_info&&g(o,a.scroll_info,n),a.disable_scrolling&&s.find(".crocodoc-viewport").css("overflow","hidden"),current_page=e.data.page;var r={current_page:current_page,total_pages:e.data.numPages};c.resolve(r)}),o.on("pagefocus",function(e){i(s,e)}),o.on("scrollstart",function(e){m.info("scrollstart : left = "+e.data.scrollLeft+", top = "+e.data.scrollTop)}),o.on("scrollend",function(e){m.info("scrollend : left = "+e.data.scrollLeft+", top = "+e.data.scrollTop),r.call(s,s.find(".content-player-outer"),o,e)}),c.promise()},v.destroy=function(e){var t=e.find(".content-player-outer");if(0!==t.length){var a=p(t.find("ul.nav")[0]).attr("data-content-area-id"),o=n(a);if(d(a,o,e,!1),"yes"===t.attr("data-is-shared")){var i=e.attr("data-tab-uuid");h.send_info("*","content-destroyed",{uuid:i},0)}}},v.navigate=function(e,t){var a=p(e).find(".content-area").attr("id"),o=n(a);m.info("navigate to : "+t.page,t),o.handle.scrollTo(t.page)},v.scroll_to=function(e,t){var a=p(e).find(".content-area").attr("id"),o=n(a);m.info("scroll to : left = "+t.scroll_to.scrollLeft+", top = "+t.scroll_to.scrollTop),o.handle.scrollToOffset(t.scroll_to.scrollLeft,t.scroll_to.scrollTop,t.zoom)};var w=[{layout:Crocodoc.LAYOUT_VERTICAL_SINGLE_COLUMN,tooltip:"Vertical, Single Column, Scrollable"},{layout:Crocodoc.LAYOUT_HORIZONTAL,tooltip:"Horizontal, Single Row, Scrollable"},{layout:Crocodoc.LAYOUT_PRESENTATION,tooltip:"Presentation, One page at a time"},{layout:Crocodoc.LAYOUT_PRESENTATION_TWO_PAGE,tooltip:"Presentation, Two pages at a time"}],T=0,P={loading:!0,preview:!0,fullview:!0,"fullview-with-library":!0};return v}),define("upload",["require","jquery","events","jade","identity","log"],function(e){function t(e,t){e.status_span.html(t)}function n(e,n){i(e),n&&(this&&t(e,this),n&&n.error_message&&(n=n.error_message),u(e.progress,n),r(e,n))}function a(){var e=this;i(e),t(e,"")}function o(e){e.upload_input.prop("disabled",!0)}function i(e){e.upload_input.prop("disabled",!1)}function r(e,t){var n=e.error_span,a="object"==typeof t?"Server Error":t;w.error("mark_error : err = ",t),n.html(a),n.css("display","block")}function s(e){e.error_span.html(""),e.error_span.css("display","none")}function l(e){var n=v.Deferred(),a=this,o=a.file;w.info("upload_start : data = ",e);var i=new XMLHttpRequest;return i.open("PUT",e.upload_url),i.setRequestHeader("x-amz-acl","public-read"),i.upload.addEventListener("progress",d.bind(null,a)),i.onload=function(){return 200!==i.status?(n.reject("upload failed with status code "+i.status),void u(a.progress,i.status)):(n.resolve(e,o),void u(a.progress,null))},i.onerror=function(e){w.error("upload_start: err = ",e),t(a,"Upload Failed"),n.reject(e)},i.send(o),t(a,"Uploading ..."),n.promise()}function c(e){e.find(".progress-bar").removeClass("progress-bar-danger"),e.find(".progress-bar").removeClass("progress-bar-success"),e.find(".progress-bar").css("width","0%"),e.fadeIn(500)}function u(e,t){e.find(".progress-bar").addClass("progress-bar-"+(t?"danger":"success")),e.find(".progress-bar").removeClass("progress-bar-"+(t?"success":"danger")),e.fadeOut(500)}function d(e,t){if(t.lengthComputable===!0){t.loaded/t.total*100;e.progress.find(".progress-bar").css("width",parseInt(t.loaded/t.total*100,10)+"%")}}function f(e,n){var a=v.Deferred(),o=this;t(o,"Finalizing upload ...");var i="upload_complete",r={name:n.name,path:"/vctemp/"+encodeURI(n.name),type:n.type,size:n.size,url:e.access_url,user_id:"arvind@authorgen.com",vc_id:b.identity.vc_id,u_name:b.identity.id,removeafter:3600,tags:"content, pdf"};return o.busy.css("display","block"),b.send_command(null,i,r,0).then(function(t){a.resolve(e,t)},function(e){a.reject(e),t(o,"Upload Complete Info Error.")}),a.promise()}function g(e,n){var a=v.Deferred(),o=this;t(o,"Processing ...");var i="start-conversion",r={name:n.name,path:"/"+encodeURI(n.name),type:n.type,size:n.size,url:e.access_url,user_id:o.email,vc_id:b.identity.vc_id,u_name:b.identity.id,tags:"content, pdf"};return o.busy.css("display","block"),b.send_command(null,i,r,0).then(function(n){a.resolve(e,n),t(o,"Conversion Finished")},function(e){a.reject(e),t(o,"Conversion Failed")}).always(function(){o.busy.css("display","none")}),a.promise()}function p(e,t,n){var a=v.Deferred();return P.emit("content-added",{tab:e.tab_anchor,name:n.name,type:n.type,created_at:n.created_at,id:n.id,raw_file_url:t.access_url,conv_url:n.url,thumbnail:n.thumbnail}),a.resolve(t),a.promise()}function h(){}function m(e){var t=e.file,n="get-tmp-url",a={path:"/vctemp/"+encodeURI(t.name),name:t.name,type:t.type?t.type:t.name.replace(/^.*\./g,""),user_id:e.email};return w.info("get_presigned_url: sending ",a),b.send_command(null,n,a,0)}var v=e("jquery"),y=e("events");window.jade=e("jade");var b,w=(e("identity"),e("log")("upload","info")),T={},P=y.emitter("content:upload","upload");return T.init=function(e,t,n,a){return b=a,h(),!0},T.prepare=function(e){var i={};i.anchor=e.anchor,i.email=e.email,i.upload_span=i.anchor.find(".content-upload-label"),i.upload_input=i.anchor.find(".content-upload-input"),i.error_span=i.anchor.find(".content-upload-error"),i.status_span=i.anchor.find(".content-upload-status"),i.progress=i.anchor.find(".progress"),i.busy=i.anchor.find(".content-conversion-busy"),i.upload_span.on("click",function(e){i.upload_input.trigger("click")}),i.upload_input.on("click",function(e){s(i),t(i,""),i.upload_input.val(null)}),i.upload_input.on("change",function(r){var s=v(r.currentTarget)[0].files;s&&0!==s.length&&(o(i),c(i.progress),t(i,"Requesting ..."),i.file=s[0],m(i).then(l.bind(i),n.bind("Request Failed",i)).then(f.bind(i),n.bind("Upload Failed",i)).then(g.bind(i),n.bind("Upload Failed",i)).then(p.bind(i,e),n.bind("Conversion Failed",i)).then(a.bind(i),n.bind("Post Conversion Failed",i)))})},T}),define("library",["require","jquery","events","jade","log","./upload","./player"],function(e){function t(e,t){o(e).then(i.bind(t),a.bind(t)).then(n.bind(t))}function n(){var e=this;e.find("span.busy").fadeOut()}function a(e){for(var t=d("#widget-tabs").find(".content-lib-main"),n=0;n<t.length;n++){var a=d(t[n]);a.find(".busy").css("display","none"),a.find(".content-lib-error").css("display","inline").html(e)}}function o(e){var t="get-content",n={user_id:e};return g.send_command(null,t,n,0)}function i(e){for(var t=this,n=0;n<e.data.length;n++){var a=e.data[n];r(t,a)}}function r(e,t){var n=g.template("library-item"),a=n(t);e.find(".content-lib-items ul").append(a)}function s(){d("#widget-tabs").on("click","a.content-preview-trigger",c)}function l(e){return"content-area-"+e}function c(e){var t=d(e.currentTarget).closest(".content-lib-main"),n=t.attr("data-tab-anchor-id"),a=t.closest("#"+n)[0],o=d(e.currentTarget).attr("data-content-url");m.start(a,o,{show_menu:!0,mode:"preview"})}function u(e,t){switch(e){case"content-added":for(var n=d(t.tab),a=t.conv_url,o=d("#widget-tabs").find(".content-lib-main"),i=0;i<o.length;i++){var s=d(o[i]);r(s,{name:t.name,url:t.conv_url,type:t.type,thumbnail:t.thumbnail})}m.start(n,a,{show_menu:!0,show_library_icon:!0,mode:"preview"});break;default:p.error('unknown event "'+e+'". possibly a bug in the code. ignoring.')}}var d=e("jquery"),f=e("events");window.jade=e("jade");var g,p=e("log")("library","info"),h=e("./upload"),m=e("./player"),v={};return f.bind("content:upload",u,"library"),v.init=function(e,t,n,a){return g=a,s(),!0},v.start=function(e){var n=e.anchor,a=d(n).attr("id"),o=d.Deferred();p.info("identity - ",g.identity);var i=g.identity.emails,r=i?i[0].value:"test@wiziq.com";"-----"===r&&(r="test@wiziq.com");var s=g.template("library");l(a);return d(n).append(s({tab_anchor_id:a,email:r})),h.prepare({anchor:d(n).find(".content-lib-upload"),tab_anchor:n,email:r}),t(r,d(n).find(".content-lib-main")),o.resolve(),o.promise()},v.destroy=function(e){e.empty()},v}),define("content",["require","jquery","jade","log","framework","./player","./library","./upload"],function(e){function t(e){var t={uuid:e.uuid,remote_slave:e.remote_slave,
startup:e.startup||!1},n=d.tabs.get_by_uuid(e.uuid);n||(n=d.tabs.create(t)),t={shared:e.shared,show_menu:e.show_menu,mode:"fullview",scroll_info:e.scroll_info,disable_scrolling:e.disable_scrolling||!1},s.start(n.anchor,e.content_uri,t)}function n(e){var t=d.tabs.get_by_uuid(e.uuid);return t?void s.navigate(t.anchor,e):void i.error("rx remote navigation for non-existent tab : uuid = "+e.uuid)}function a(e){var t=d.tabs.get_by_uuid(e.uuid);return t?void s.scroll_to(t.anchor,e):void i.error("rx remote scroll for non-existent tab : uuid = "+e.uuid)}var o=e("jquery");window.jade=e("jade");var i=e("log")("content","info"),r=e("framework"),s=e("./player"),l=e("./library"),c=e("./upload"),u={},d=r.handle("content");return u.init=function(e,t,n){var a=o.Deferred();return l.init(e,t,n,d)?c.init(e,t,n,d)?s.init(e,t,n,d)?(a.resolve(),a.promise()):(a.reject("content player init failed"),a.promise()):(a.reject("content upload init failed"),a.promise()):(a.reject("content library init failed"),a.promise())},u.info=function(e,o,r,s){switch(o){case"new-content":return r.remote_slave=!0,r.show_menu=!1,r.shared=!1,r.disable_scrolling=!0,t(r);case"navigate-to":return n(r);case"scroll-to":return a(r);default:return void i.error("received unknown info_id ("+o+"). Ignoring.")}},u.start=function(e){i.info("sess_info = ",e);for(var n in e.shared){var a=d.identity.vc_id,o=e.shared[n].owner===a?!1:!0,r=o?!0:!1;o||(u.create({uuid:n,remote_slave:o,startup:!0}),d.tabs.sync_remote({uuid:n})),t({uuid:n,content_uri:e.shared[n].content_uri,remote_slave:o,show_menu:o?!1:!0,shared:o?!1:!0,scroll_info:e.shared[n].scroll_info,startup:!0,disable_scrolling:r})}},u.create=function(e){var t=e||{},n=d.tabs.create(t);return l.start(n)},u.destroy=function(e,t){i.info("content.destroy: $tab_anchor",e,"uuid = "+t),s.destroy(e),l.destroy(e)},u}),require([""]);