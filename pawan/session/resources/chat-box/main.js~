var $ = require('jquery-deferred');
//var Client = require('node-rest-client').Client;
var rest = require('restler');
var chat = {};


/*
		create a room through API call
		when init user is called : add user to room and return room id and authentication tokens etc	


	*/

chat.init = function (myinfo, common, handles) { 

	
	var _d = $.Deferred ();
	log = handles.log;

	log.info ('chat-box: init :', myinfo);
	
	//create a room
	//client = new Client();
	rest.get('http://localhost:5000/rooms').on('complete', function(data){
		console.log( data );
	});
	
	_d.resolve ();
	return _d.promise ();
};
chat.init_user = function (user) { 
	var _d = $.Deferred ();
	
//	some get requests and some post
		
	//_d.resolve( "");// httpGet("http://localhost:5000/rooms") );
		
	/*j$.get("http://localhost:5000/rooms", function(data){
		_d.resolve( data );
	});*/

	_d.resolve ({
		host : '127.0.0.1',
		port : '5000',
		remarks : 'have fun'
	});

	return _d.promise ();
};

function httpGet(theUrl)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
    xmlHttp.send( null );
    return xmlHttp.response;
}

function httpGetAsync(theUrl, callback)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            callback(xmlHttp.responseText);
    }
    xmlHttp.open("GET", theUrl, true); // true for asynchronous 
    xmlHttp.send(null);
}

module.exports = chat;
